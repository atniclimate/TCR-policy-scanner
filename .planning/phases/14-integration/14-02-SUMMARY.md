---
phase: 14-integration
plan: 02
subsystem: packet-generation
tags: [docx, document-types, air-gap, audience-targeting, configuration]
requires:
  - "Phase 7: DOCX generation engine (DocxEngine, StyleManager, HotSheetRenderer)"
  - "Phase 8: Section renderers (cover page, TOC, exec summary, delegation, hazards, asks)"
provides:
  - "DocumentTypeConfig dataclass with 4 pre-built instances (DOC_A/B/C/D)"
  - "Audience-differentiated headers, footers, and cover pages"
  - "Air-gap-compliant document surfaces (zero org attribution)"
  - "DOC_TYPES lookup dict for runtime type selection"
affects:
  - "Plan 14-03: Content filtering (uses include_* flags from DocumentTypeConfig)"
  - "Plan 14-04: Regional documents (uses DOC_C/DOC_D with region_name)"
  - "Plan 14-05: Batch generation (uses DOC_TYPES dict for multi-type output)"
tech-stack:
  added: []
  patterns:
    - "Frozen dataclass for immutable configuration"
    - "Template method pattern for header/footer substitution"
    - "Backward-compatible optional parameter (doc_type_config=None)"
key-files:
  created:
    - src/packets/doc_types.py
    - tests/test_doc_types.py
  modified:
    - src/packets/docx_engine.py
    - src/packets/docx_sections.py
    - src/packets/docx_styles.py (test only)
    - src/packets/docx_template.py
    - src/packets/strategic_overview.py
    - tests/test_docx_styles.py
    - tests/test_docx_template.py
key-decisions:
  - id: DEC-1402-01
    decision: "Default doc_type_config is None (not DOC_B) for full backward compatibility"
    rationale: "Existing callers pass no doc_type_config; changing default would alter behavior"
  - id: DEC-1402-02
    decision: "Air gap covers all src/packets/ files including strategic_overview and docx_template"
    rationale: "Plan scope says src/packets/; comprehensive scrub prevents any remaining leaks"
  - id: DEC-1402-03
    decision: "Cover page shows 'For Congressional Office Use' as default classification"
    rationale: "Matches DOC_B (most common existing output); internal docs override via config"
duration: ~13 minutes
completed: 2026-02-11
---

# Phase 14 Plan 02: Document Type Configuration & Air Gap Summary

DocumentTypeConfig frozen dataclass with DOC_A/B/C/D instances, audience-differentiated headers/footers in DocxEngine, and comprehensive air gap scrub removing all organizational attribution from generated document surfaces.

## Performance

| Metric | Value |
|--------|-------|
| Duration | ~13 minutes |
| Start | 2026-02-11T19:55:44Z |
| End | 2026-02-11T20:08:37Z |
| Tasks | 2/2 |
| Files created | 2 |
| Files modified | 6 |
| Tests added | 41 |
| Tests updated | 2 |
| Total tests passing | 647 (606 existing + 41 new) |

## Accomplishments

1. **DocumentTypeConfig dataclass** -- Frozen, immutable configuration with 14 fields covering audience, scope, confidentiality, content flags, narrative voice, structural asks framing, and filename generation.

2. **Four pre-built instances** -- DOC_A (Tribal Internal Strategy), DOC_B (Tribal Congressional Overview), DOC_C (Regional InterTribal Strategy), DOC_D (Regional Congressional Overview) with correct audience targeting per PHASE-14-DESIGN-DECISIONS.md.

3. **DocxEngine integration** -- `__init__` and `generate()` accept optional `doc_type_config` parameter. When provided, headers, footers, and cover pages are customized for the target audience. When None, engine works exactly as before (backward compatible).

4. **Air gap scrub** -- Removed all "TCR Policy Scanner", "Tribal Advocacy Packet", and "Generated by" strings from:
   - `docx_engine.py` `_setup_header_footer()`
   - `docx_template.py` `TemplateBuilder._setup_header_footer()`
   - `strategic_overview.py` `_setup_header_footer()`
   - `docx_sections.py` `render_cover_page()` classification notice

5. **Cover page differentiation** -- Internal docs (A/C) show CONFIDENTIAL banner above title and "Confidential: For Internal Use Only" classification. Congressional docs (B/D) show "For Congressional Office Use" classification.

6. **41 new tests** -- Config basics, frozen immutability, confidentiality flags, content inclusion flags, audience/scope properties, narrative voice, header formatting with placeholder substitution, filename generation, and air gap compliance across all 4 types.

## Task Commits

| Task | Name | Commit | Key Files |
|------|------|--------|-----------|
| 1 | Create DocumentTypeConfig system | `3a72618` | src/packets/doc_types.py, tests/test_doc_types.py |
| 2 | Update DocxEngine and cover page for doc-type-aware generation | `b2d9b1b` | src/packets/docx_engine.py, docx_sections.py, docx_template.py, strategic_overview.py, tests/test_docx_styles.py, tests/test_docx_template.py |

## Files Created

- `src/packets/doc_types.py` -- DocumentTypeConfig dataclass, DOC_A/B/C/D instances, DOC_TYPES dict, helper methods (185 lines)
- `tests/test_doc_types.py` -- 41 tests across 8 test classes (288 lines)

## Files Modified

- `src/packets/docx_engine.py` -- Added doc_type_config parameter to __init__/generate, rewrote _setup_header_footer for air gap compliance, added from __future__ import annotations
- `src/packets/docx_sections.py` -- render_cover_page accepts doc_type_config, audience-aware title/classification, added from __future__ import annotations
- `src/packets/docx_template.py` -- TemplateBuilder._setup_header_footer air gap fix (header and footer text)
- `src/packets/strategic_overview.py` -- _setup_header_footer air gap fix (footer text)
- `tests/test_docx_styles.py` -- Updated test_engine_header_footer to verify air-gap-compliant text
- `tests/test_docx_template.py` -- Updated test_build_header_text and test_build_footer_text for air gap

## Decisions Made

1. **DEC-1402-01: Default doc_type_config is None** -- Existing callers pass no config; the engine uses generic FY26 headers/footers when no config is provided, preserving exact backward compatibility.

2. **DEC-1402-02: Comprehensive air gap scrub** -- Extended beyond just docx_engine.py to cover docx_template.py and strategic_overview.py, since both generated visible document surfaces with organizational attribution.

3. **DEC-1402-03: Congressional as default classification** -- When no doc_type_config is provided, the cover page shows "For Congressional Office Use" (matching current DOC_B-like behavior) rather than the old "CONFIDENTIAL -- For Congressional Office Use Only" which was contradictory.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed air gap violations in docx_template.py and strategic_overview.py**

- **Found during:** Task 2, air gap grep
- **Issue:** Plan listed docx_engine.py, docx_sections.py, docx_styles.py for air gap scrub, but docx_template.py (TemplateBuilder) and strategic_overview.py also contained "TCR Policy Scanner" and "Generated by" strings in document surfaces
- **Fix:** Updated both files to use air-gap-compliant text
- **Files modified:** src/packets/docx_template.py, src/packets/strategic_overview.py

**2. [Rule 1 - Bug] Updated tests that asserted old air-gap-violating text**

- **Found during:** Task 2, test verification
- **Issue:** test_docx_styles.py::test_engine_header_footer and test_docx_template.py::test_build_header_text/test_build_footer_text asserted "TCR Policy Scanner" in headers/footers
- **Fix:** Updated assertions to verify air-gap-compliant text and assert absence of org names
- **Files modified:** tests/test_docx_styles.py, tests/test_docx_template.py

## Issues Encountered

None -- plan executed cleanly. One pre-existing test failure (test_schemas.py::test_nri_has_18_hazard_types) was confirmed as pre-existing data incompleteness, not caused by this plan's changes.

## Next Phase Readiness

Plan 14-03 (Content Filtering) can proceed immediately:
- DocumentTypeConfig provides `include_strategy`, `include_advocacy_lever`, `include_member_approach`, `include_messaging_framework` flags
- DocxEngine passes `doc_type_config` through to renderers
- The 9-section generate() flow is unchanged and ready for section-level filtering
- `structural_asks_framing` and `narrative_voice` fields are available for tone calibration

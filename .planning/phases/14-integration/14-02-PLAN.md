---
phase: 14-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/packets/doc_types.py
  - src/packets/docx_engine.py
  - src/packets/docx_sections.py
  - src/packets/docx_styles.py
  - tests/test_doc_types.py
autonomous: true

must_haves:
  truths:
    - "DocumentTypeConfig defines all 4 document types (A/B/C/D) with audience, scope, header, footer, and content-filter flags"
    - "DocxEngine accepts doc_type parameter and applies type-specific headers and footers"
    - "Air gap is enforced: no 'TCR Policy Scanner' or organizational names in any generated document"
    - "Internal docs show CONFIDENTIAL header; congressional docs show clean header"
  artifacts:
    - path: "src/packets/doc_types.py"
      provides: "DocumentTypeConfig dataclass and DOC_A/B/C/D instances"
      exports: ["DocumentTypeConfig", "DOC_A", "DOC_B", "DOC_C", "DOC_D"]
    - path: "tests/test_doc_types.py"
      provides: "Tests for document type configuration and audience filtering"
      min_lines: 40
  key_links:
    - from: "src/packets/doc_types.py"
      to: "src/packets/docx_engine.py"
      via: "DocxEngine.__init__ accepts DocumentTypeConfig"
      pattern: "DocumentTypeConfig"
    - from: "src/packets/docx_engine.py"
      to: "src/packets/docx_sections.py"
      via: "render_cover_page receives doc_type_config"
      pattern: "doc_type_config"
---

<objective>
Create the DocumentTypeConfig system and apply air-gap-compliant headers/footers so the engine can produce audience-differentiated documents.

Purpose: The existing DocxEngine produces a single hybrid document. Phase 14 requires 4 document types with different headers, footers, confidentiality markings, and content rules. This plan builds the configuration layer and updates the engine's document setup (headers/footers/cover page) without yet changing section-level content filtering (that's Plan 14-03).

Output: doc_types.py module with DOC_A/B/C/D configs; DocxEngine updated to use doc_type_config for headers/footers; air gap violations removed from generated documents.
</objective>

<execution_context>
@D:\Claude-Workspace\.claude/get-shit-done/workflows/execute-plan.md
@D:\Claude-Workspace\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/PHASE-14-DESIGN-DECISIONS.md
@src/packets/docx_engine.py
@src/packets/docx_sections.py
@src/packets/docx_styles.py
@src/packets/context.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DocumentTypeConfig system</name>
  <files>src/packets/doc_types.py, tests/test_doc_types.py</files>
  <action>
  Create `src/packets/doc_types.py` with the DocumentTypeConfig dataclass and 4 pre-built instances.

  The dataclass:
  ```python
  @dataclass(frozen=True)
  class DocumentTypeConfig:
      doc_type: str          # "A", "B", "C", "D"
      audience: str          # "internal", "congressional"
      scope: str             # "tribal", "regional"
      title_template: str    # Cover page title (e.g., "FY26 Federal Funding Overview & Strategy")
      header_template: str   # Per-page header (supports {tribe_name}, {region_name} placeholders)
      footer_template: str   # Per-page footer text
      confidential: bool     # Whether CONFIDENTIAL banner appears
      include_strategy: bool       # Leverage, approach, messaging sections
      include_advocacy_lever: bool # Per-program advocacy lever text
      include_member_approach: bool # Member-specific approach recommendations
      include_messaging_framework: bool  # Audience-calibrated talking points section
      structural_asks_framing: str  # "strategic" or "policy_recommendation"
      narrative_voice: str   # "assertive" or "objective"
      filename_suffix: str   # e.g., "internal_strategy", "congressional_overview"
  ```

  Four instances:

  DOC_A (Tribal Internal Strategy):
  - doc_type="A", audience="internal", scope="tribal"
  - title_template="FY26 Federal Funding Overview & Strategy"
  - header_template="{tribe_name} | Internal Strategy | CONFIDENTIAL"
  - footer_template="Confidential: For Internal Use Only"
  - confidential=True
  - All include_* flags = True
  - structural_asks_framing="strategic"
  - narrative_voice="assertive"
  - filename_suffix="internal_strategy"

  DOC_B (Tribal Congressional Overview):
  - doc_type="B", audience="congressional", scope="tribal"
  - title_template="FY26 Climate Resilience Program Priorities"
  - header_template="{tribe_name} | FY26 Climate Resilience Program Priorities"
  - footer_template="For Congressional Office Use"
  - confidential=False
  - All include_* flags = False
  - structural_asks_framing="policy_recommendation"
  - narrative_voice="objective"
  - filename_suffix="congressional_overview"

  DOC_C (Regional InterTribal Strategy):
  - doc_type="C", audience="internal", scope="regional"
  - title_template="FY26 InterTribal Climate Resilience Strategy"
  - header_template="{region_name} | Regional Strategy | CONFIDENTIAL"
  - footer_template="Confidential: For Internal Use Only"
  - confidential=True
  - include_strategy=True, include_advocacy_lever=True, include_member_approach=True, include_messaging_framework=False
  - structural_asks_framing="strategic"
  - narrative_voice="assertive"
  - filename_suffix="intertribal_strategy"

  DOC_D (Regional Congressional Overview):
  - doc_type="D", audience="congressional", scope="regional"
  - title_template="FY26 Regional Climate Resilience Overview"
  - header_template="{region_name} | FY26 Regional Climate Resilience Overview"
  - footer_template="For Congressional Office Use"
  - confidential=False
  - All include_* flags = False
  - structural_asks_framing="policy_recommendation"
  - narrative_voice="objective"
  - filename_suffix="congressional_overview"

  Add helper methods:
  - `is_internal` property -> bool (audience == "internal")
  - `is_congressional` property -> bool (audience == "congressional")
  - `is_tribal` property -> bool (scope == "tribal")
  - `is_regional` property -> bool (scope == "regional")
  - `format_header(tribe_name=None, region_name=None)` -> str (substitutes placeholders)
  - `format_filename(slug)` -> str (returns "{slug}_{filename_suffix}_fy26.docx")

  Also add a dict:
  ```python
  DOC_TYPES = {"A": DOC_A, "B": DOC_B, "C": DOC_C, "D": DOC_D}
  ```

  Create `tests/test_doc_types.py` with tests verifying:
  - All 4 configs have distinct doc_type values
  - DOC_A and DOC_C are confidential; DOC_B and DOC_D are not
  - DOC_A and DOC_C include strategy; DOC_B and DOC_D do not
  - format_header substitutes placeholders correctly
  - format_filename produces correct patterns
  - is_internal/is_congressional properties are correct
  - No config contains "TCR Policy Scanner", "ATNI", "NCAI", or any org name
  </action>
  <verify>
  `python -m pytest tests/test_doc_types.py -v` -- all tests pass
  </verify>
  <done>doc_types.py exports DocumentTypeConfig + DOC_A/B/C/D + DOC_TYPES; all tests pass; no organizational attribution in any config</done>
</task>

<task type="auto">
  <name>Task 2: Update DocxEngine and cover page for doc-type-aware generation</name>
  <files>src/packets/docx_engine.py, src/packets/docx_sections.py, src/packets/docx_styles.py</files>
  <action>
  Modify DocxEngine to accept and use DocumentTypeConfig:

  1. **DocxEngine.__init__**: Add optional `doc_type_config: DocumentTypeConfig = None` parameter. Default to DOC_B for backward compatibility (the current single-doc output most closely resembles the congressional overview). Store as `self.doc_type_config`.

  2. **DocxEngine.create_document()**: After creating the Document, set headers and footers based on doc_type_config:
     - If doc_type_config is provided:
       * Set the default header to `doc_type_config.format_header(tribe_name=..., region_name=...)` -- the tribe/region name will need to be passed in or set later. For now, store the config and apply headers in `generate()` where context is available.
     - Remove the existing "TCR Policy Scanner | Tribal Advocacy Packet" header text. Replace with doc-type-specific header.
     - Remove the existing "Generated by TCR Policy Scanner" footer text. Replace with doc-type-specific footer + "Page {PAGE} of {NUMPAGES}" field.

  3. **DocxEngine.generate()**: Accept `doc_type_config` parameter (or use self.doc_type_config). After creating the document, apply:
     - Header: `doc_type_config.format_header(tribe_name=context.tribe_name)`
     - Footer: `doc_type_config.footer_template` + " | Page X of Y" + generation date
     - If confidential: add CONFIDENTIAL banner to first page header
     - Pass `doc_type_config` to `render_cover_page()` so it can differentiate cover pages

  4. **render_cover_page() in docx_sections.py**: Accept optional `doc_type_config` parameter. When provided:
     - Use `doc_type_config.title_template` for the document title
     - If confidential, add confidentiality banner at top: "CONFIDENTIAL -- FOR INTERNAL TRIBAL USE ONLY"
     - Remove any "TCR Policy Scanner" text from the cover page
     - Add audience classification line: "For Congressional Office Use" or "Confidential: For Internal Use Only"

  5. **Air gap scrub**: Search docx_sections.py, docx_engine.py, and docx_styles.py for any string containing "TCR Policy Scanner", "ATNI", "Tribal Advocacy Packet", or "Generated by". Replace with doc-type-appropriate text or remove entirely.

  IMPORTANT: Do NOT change the section rendering order or content filtering yet -- that's Plan 14-03. This task only changes the document wrapper (headers, footers, cover page, metadata). The 9-section generate() flow should continue to work unchanged for backward compatibility.

  Ensure backward compatibility: if `doc_type_config` is None, the engine should work exactly as before (minus air gap violations which should be fixed regardless).
  </action>
  <verify>
  1. `python -m pytest tests/test_doc_assembly.py tests/test_docx_integration.py tests/test_docx_styles.py -v` -- existing tests pass
  2. `python -m pytest tests/test_doc_types.py -v` -- new tests pass
  3. `python -c "from src.packets.docx_engine import DocxEngine; from src.packets.doc_types import DOC_A, DOC_B; print('Import OK')"` -- imports work
  4. Grep for "TCR Policy Scanner" in src/packets/ -- should return zero matches (air gap clean)
  </verify>
  <done>DocxEngine accepts DocumentTypeConfig; headers/footers are doc-type-specific; zero air gap violations in src/packets/; all existing tests pass</done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- all 606+ tests pass
2. `python -c "from src.packets.doc_types import DOC_A, DOC_B, DOC_C, DOC_D; print('All 4 doc types importable')"` -- imports clean
3. Grep `src/packets/` for "TCR Policy Scanner", "ATNI", "NCAI" -- zero results
4. DOC_A.confidential == True, DOC_B.confidential == False
5. DOC_A.include_strategy == True, DOC_B.include_strategy == False
</verification>

<success_criteria>
- doc_types.py module defines all 4 document types with complete configuration
- DocxEngine generates documents with correct headers/footers per doc type
- Air gap: zero organizational attribution strings in generated document surfaces
- All existing tests pass without modification (backward compatible)
</success_criteria>

<output>
After completion, create `.planning/phases/14-integration/14-02-SUMMARY.md`
</output>

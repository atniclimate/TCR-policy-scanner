---
phase: 14-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - data/ecoregion_config.json
  - data/regional_config.json
  - src/paths.py
  - scripts/populate_hazards.py
  - scripts/download_nri_data.py
autonomous: true

must_haves:
  truths:
    - "Hazard profiles for 550+ Tribes contain real NRI scores (not zeros)"
    - "8 regions defined with Tribe-to-region mapping covering all 592 Tribes"
    - "Cross-cutting region exists as a virtual region spanning all Tribes"
  artifacts:
    - path: "data/regional_config.json"
      provides: "8-region definitions with state mappings and narrative metadata"
      contains: "crosscutting"
    - path: "data/hazard_profiles/epa_100000001.json"
      provides: "Real hazard data for sample Tribe"
      contains: "risk_score"
    - path: "src/paths.py"
      provides: "REGIONAL_CONFIG_PATH constant"
      contains: "regional_config"
  key_links:
    - from: "data/regional_config.json"
      to: "data/ecoregion_config.json"
      via: "complementary configs (ecoregion for relevance, regional for doc C/D grouping)"
      pattern: "regional_config"
---

<objective>
Activate hazard data and establish the 8-region configuration so downstream document generation has real data to work with.

Purpose: Phase 13 built the hazard population scripts but NRI source data was never downloaded/populated in this workspace. All 592 hazard profiles show zeros. Additionally, the current 7-ecoregion config doesn't match the 8 regions needed for Doc C/D regional documents. This plan resolves both data gaps.

Output: 550+ Tribes with real hazard scores; 8-region config file ready for regional document aggregation.
</objective>

<execution_context>
@D:\Claude-Workspace\.claude/get-shit-done/workflows/execute-plan.md
@D:\Claude-Workspace\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-hazard-population/13-03-SUMMARY.md
@src/paths.py
@data/ecoregion_config.json
@scripts/download_nri_data.py
@scripts/populate_hazards.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Download NRI source data and populate hazard profiles</name>
  <files>scripts/download_nri_data.py, scripts/populate_hazards.py</files>
  <action>
  Run the existing Phase 13 scripts to download NRI data and populate hazard profiles:

  1. Run `python scripts/download_nri_data.py` to download FEMA NRI county-level CSV and shapefiles into `data/nri/`. This script was built in Phase 13 (13-01-PLAN.md). It downloads:
     - NRI county CSV (risk scores for 18 hazard types)
     - AIANNH shapefile (Tribal geographic boundaries)
     - County shapefile (for crosswalk)

  2. Run `python scripts/populate_hazards.py` to populate all 592 hazard profile JSON files using:
     - Area-weighted NRI county score aggregation to Tribal boundaries
     - Top-5 hazard extraction and ranking
     - USFS wildfire risk overlay (if USFS data available)

  3. Verify coverage: check that 550+ of 592 hazard profiles now have non-zero `risk_score` in `sources.fema_nri.composite`. Use a quick Python one-liner to count populated profiles.

  If download_nri_data.py fails (network issue, URL changed), check the script's download URLs and update if needed. The NRI data is publicly available from FEMA.

  If populate_hazards.py fails, check that it can find the NRI CSV at the expected path (likely `data/nri/NRI_Table_Counties.csv` or similar). The script has hard prerequisite on NRI county CSV per DEC-1303-06.
  </action>
  <verify>
  Run: `python -c "import json, pathlib; profiles = list(pathlib.Path('data/hazard_profiles').glob('*.json')); populated = sum(1 for p in profiles if json.loads(p.read_text()).get('sources',{}).get('fema_nri',{}).get('composite',{}).get('risk_score',0) > 0); print(f'{populated}/{len(profiles)} hazard profiles populated')"`

  Expected: 550+/592 hazard profiles populated.
  </verify>
  <done>550+ hazard profile JSON files contain real NRI risk scores, top-5 hazards, and ratings (not zeros or placeholders)</done>
</task>

<task type="auto">
  <name>Task 2: Create 8-region configuration for Doc C/D regional documents</name>
  <files>data/regional_config.json, src/paths.py</files>
  <action>
  Create `data/regional_config.json` defining the 8 regions from 14-CONTEXT.md. This is a NEW file separate from ecoregion_config.json (which continues to serve per-Tribe relevance filtering with its 7-region NCA5 scheme).

  The regional_config.json structure:
  ```json
  {
    "version": "1.0",
    "description": "Regional groupings for Doc C/D document generation (8 regions)",
    "regions": {
      "pnw": {
        "name": "Pacific Northwest / Columbia River Basin",
        "short_name": "Pacific Northwest",
        "states": ["WA", "OR", "ID", "MT"],
        "core_frame": "Drought, fisheries, snowpack, wildfire, treaty salmon, flood",
        "key_programs": ["bia_tcr", "noaa_tribal", "usda_wildfire", "epa_stag"],
        "treaty_trust_angle": "Treaty fisheries, ceded lands, salmon recovery"
      },
      "alaska": {
        "name": "Alaska",
        "short_name": "Alaska",
        "states": ["AK"],
        "core_frame": "Permafrost, coastal erosion, displacement/relocation, infrastructure failure",
        "key_programs": ["bia_tcr", "epa_stag", "hud_ihbg"],
        "treaty_trust_angle": "Existential displacement, trust responsibility, ANCSA"
      },
      "plains": {
        "name": "Great Plains / Northern Plains",
        "short_name": "Great Plains",
        "states": ["ND", "SD", "NE", "KS", "OK", "TX", "MN", "IA", "MO", "WY"],
        "core_frame": "Drought, water scarcity, extreme heat, wind energy, rangeland",
        "key_programs": ["usbr_watersmart", "usbr_tap", "doe_indian_energy", "bia_tcr"],
        "treaty_trust_angle": "Water rights, treaty obligations, reserved rights"
      },
      "southwest": {
        "name": "Southwest / Great Basin",
        "short_name": "Southwest",
        "states": ["AZ", "NM", "NV", "UT", "CO"],
        "core_frame": "Drought, wildfire, extreme heat, water rights, solar energy",
        "key_programs": ["usbr_watersmart", "doe_indian_energy", "usda_wildfire", "bia_tcr"],
        "treaty_trust_angle": "Senior water rights, Colorado River, Winters doctrine"
      },
      "greatlakes": {
        "name": "Great Lakes / Midwest",
        "short_name": "Great Lakes",
        "states": ["WI", "MI", "IL", "IN", "OH"],
        "core_frame": "Flooding, invasive species, PFAS, algal blooms, treaty resources",
        "key_programs": ["epa_gap", "epa_stag", "noaa_tribal", "bia_tcr"],
        "treaty_trust_angle": "Treaty resources (wild rice, fisheries), ceded territories"
      },
      "southeast": {
        "name": "Southeast / Gulf Coast / Five Tribes",
        "short_name": "Southeast",
        "states": ["FL", "AL", "MS", "LA", "AR", "TN", "NC", "SC", "GA", "VA"],
        "core_frame": "Hurricanes, sea level rise, displacement, coastal resilience",
        "key_programs": ["bia_tcr", "hud_ihbg", "noaa_tribal", "fema_tribal_mitigation"],
        "treaty_trust_angle": "Coastal displacement, trust responsibility, removal history"
      },
      "northeast": {
        "name": "Northeast / Mid-Atlantic / South and Eastern Tribes",
        "short_name": "Northeast",
        "states": ["ME", "NH", "VT", "MA", "CT", "RI", "NY", "NJ", "PA", "DE", "MD", "DC", "WV"],
        "core_frame": "Coastal flooding, sea level rise, precipitation, recognition intersection",
        "key_programs": ["noaa_tribal", "epa_gap", "epa_stag", "bia_tcr"],
        "treaty_trust_angle": "Recognition/trust land intersection, colonial-era treaties"
      },
      "crosscutting": {
        "name": "Cross-Cutting (All Regions)",
        "short_name": "Cross-Cutting",
        "states": [],
        "core_frame": "Science infrastructure, NCAR, NSF, 638/CSC, structural policy",
        "key_programs": ["bia_tcr", "epa_gap", "epa_stag", "fema_bric"],
        "treaty_trust_angle": "All treaty/trust angles, self-governance, 638 contracting"
      }
    }
  }
  ```

  The crosscutting region has empty states list -- it encompasses ALL Tribes. When generating Doc C/D for crosscutting, aggregate data from all 592 Tribes.

  Also add to `src/paths.py`:
  ```python
  REGIONAL_CONFIG_PATH = DATA_DIR / "regional_config.json"
  ```

  Place this constant alongside the existing DATA_DIR-based path constants.

  Do NOT modify `data/ecoregion_config.json` -- it continues to serve the per-Tribe relevance filtering system with its 7-ecoregion NCA5 scheme.
  </action>
  <verify>
  1. `python -c "import json; d=json.load(open('data/regional_config.json')); print(f'{len(d[\"regions\"])} regions defined'); assert len(d['regions']) == 8; print('PASS')"`
  2. `python -c "from src.paths import REGIONAL_CONFIG_PATH; print(REGIONAL_CONFIG_PATH); assert REGIONAL_CONFIG_PATH.name == 'regional_config.json'; print('PASS')"`
  3. `python -m pytest tests/ -x -q` -- all 606+ tests still pass
  </verify>
  <done>8-region config exists at data/regional_config.json with all region metadata; REGIONAL_CONFIG_PATH exported from src/paths.py; existing tests unbroken</done>
</task>

</tasks>

<verification>
1. Hazard profiles: 550+/592 populated with real NRI scores
2. Regional config: 8 regions defined including crosscutting
3. Paths module: REGIONAL_CONFIG_PATH constant available
4. Existing tests: all 606+ pass without regression
5. Ecoregion config: original ecoregion_config.json unchanged
</verification>

<success_criteria>
- 550+ hazard profiles contain real risk_score > 0, top_hazards non-empty, ratings non-empty
- data/regional_config.json exists with 8 region entries matching CONTEXT.md definitions
- src/paths.py exports REGIONAL_CONFIG_PATH
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/14-integration/14-01-SUMMARY.md`
</output>

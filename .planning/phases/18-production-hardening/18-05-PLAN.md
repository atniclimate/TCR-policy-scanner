---
phase: 18-production-hardening
plan: 05
type: execute
wave: 5
depends_on: [18-04]
gap_closure: true
files_modified:
  - outputs/bug_hunt/cyclops_findings.json
  - outputs/bug_hunt/cyclops_summary.md
  - outputs/bug_hunt/dale-gribble_findings.json
  - outputs/bug_hunt/dale-gribble_summary.md
  - outputs/bug_hunt/mr-magoo_findings.json
  - outputs/bug_hunt/mr-magoo_summary.md
  - outputs/bug_hunt/marie-kondo_findings.json
  - outputs/bug_hunt/marie-kondo_summary.md
autonomous: true

must_haves:
  truths:
    - "All 4 agents re-audit the complete system after P2/P3 fixes"
    - "Each agent produces updated findings JSON and summary markdown"
    - "No new P0 or P1 findings introduced by the fix wave"
    - "Previously fixed items are verified as resolved"
    - "Agent findings include fix_status on every item"
  artifacts:
    - path: "outputs/bug_hunt/cyclops_findings.json"
      provides: "Updated Cyclops deep code inspection findings"
    - path: "outputs/bug_hunt/dale-gribble_findings.json"
      provides: "Updated Dale Gribble security/sovereignty findings"
    - path: "outputs/bug_hunt/mr-magoo_findings.json"
      provides: "Updated Mr. Magoo experiential testing findings"
    - path: "outputs/bug_hunt/marie-kondo_findings.json"
      provides: "Updated Marie Kondo code hygiene findings"
---

<objective>
Re-deploy all 4 adversarial agents (Cyclops, Dale Gribble, Mr. Magoo, Marie Kondo) to re-audit the complete system after the P2/P3 fix wave. Each agent reviews the fixed codebase, verifies previous fixes, and reports any new findings.

Purpose: Validate that the P2/P3 remediation in Plan 18-04 resolved the issues without introducing regressions, and that no new problems emerged from the changes.

Key difference from Wave 1 (18-01): Agents now review a system with ALL previous fixes applied. The focus is on verifying fix quality and detecting unintended side effects.
</objective>

<execution_context>
@D:\Claude-Workspace\.claude\get-shit-done\workflows\execute-plan.md
@D:\Claude-Workspace\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/18-production-hardening/18-CONTEXT.md
@.planning/phases/18-production-hardening/18-RESEARCH.md
@.planning/phases/18-production-hardening/18-04-SUMMARY.md
@outputs/bug_hunt/SYNTHESIS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deploy 4 agents for re-audit</name>
  <files>outputs/bug_hunt/cyclops_findings.json, outputs/bug_hunt/cyclops_summary.md, outputs/bug_hunt/dale-gribble_findings.json, outputs/bug_hunt/dale-gribble_summary.md, outputs/bug_hunt/mr-magoo_findings.json, outputs/bug_hunt/mr-magoo_summary.md, outputs/bug_hunt/marie-kondo_findings.json, outputs/bug_hunt/marie-kondo_summary.md</files>
  <action>
Deploy all 4 adversarial agents to re-audit the complete system. Each agent must:

1. Read the current source files (post-fix)
2. Review their previous findings to verify fixes
3. Check for new issues introduced by the fixes
4. Produce updated findings JSON and summary markdown

Read the agent definitions for methodology:
- Cyclops: `.planning/cyclops.md`
- Dale Gribble: `.planning/dale-gribble.md`
- Mr. Magoo: `.planning/mr-magoo.md`
- Marie Kondo: `.planning/marie-kondo.md`

**Agent 1: Cyclops (Deep Code Inspection)**
Re-audit scope: `docs/web/js/app.js` (primary -- most changes), `docs/web/index.html`, `docs/web/css/style.css`
Focus areas:
- Verify CYCLOPS-001 (AbortController) still works with new error handling
- Verify CYCLOPS-004 fix (double-click guard)
- Verify CYCLOPS-006 fix (screen reader announcements)
- Verify CYCLOPS-015 fix (script load error differentiation)
- Check hash-based URL implementation for XSS (decodeURIComponent safety)
- Check new loading spinner for state consistency
- Check card hide/show transitions for race conditions
- Trace 8 data paths again with all new code
- Update findings JSON: mark fixed items as `verified_fixed`, add any new findings

**Agent 2: Dale Gribble (Security & Data Sovereignty)**
Re-audit scope: `docs/web/index.html` (CSP, privacy footer), `.github/workflows/*.yml` (pinned SHAs), all previous scope
Focus areas:
- Verify CSP meta tag is effective (blocks inline scripts, allows required resources)
- Verify privacy statement text is accurate and sovereignty-appropriate
- Verify pinned SHA format and that SHAs match expected versions
- Re-run full 18-item UNDRIP/OCAP/CARE checklist
- Check that DALE-011/MAGOO-007 (privacy statement) is satisfactory
- Check that CSP doesn't break SquareSpace embedding
- Update findings JSON: mark fixed items as `verified_fixed`, add any new findings

**Agent 3: Mr. Magoo (Experiential User Testing)**
Re-audit scope: Full website user journey (no source code)
Focus areas:
- Is the loading state now clear and obvious?
- Are document type descriptions helpful and understandable?
- Does the card transition feel smooth when searching for a new Tribe?
- Is the error message actionable?
- Do shareable URLs work? Can you share a link and have it pre-select the Tribe?
- Does the privacy footer build trust?
- Re-assess trust_score (target: 9+/10 with improvements)
- Update findings JSON: mark fixed items as `verified_fixed`, add any new findings

**Agent 4: Marie Kondo (Code Hygiene)**
Re-audit scope: Python pipeline (focus on changed files) + web files
Focus areas:
- Verify CFDA mapping consolidation is clean (no duplicates, no import issues)
- Verify TRIBAL_AWARD_TYPE_CODES derivation produces correct list
- Verify config.py re-export removal doesn't break anything
- Verify manifest script is equivalent to inline code
- Check new `src/scrapers/cfda_map.py` for cleanliness
- Check `scripts/build_manifest.py` for cleanliness
- Re-assess joy_score (target: 9+/10 with cleanup)
- Update findings JSON: mark fixed items, update inventory

Each agent's output REPLACES the previous findings file (not appends). The new findings file is the complete post-fix audit result.
  </action>
  <verify>
- All 4 agent findings JSON files updated with post-fix audit results
- All 4 agent summary markdown files updated
- Each finding has fix_status field (verified_fixed, new, deferred, accepted)
- Previously fixed P0/P1 items confirmed as resolved
- Previously fixed P2/P3 items confirmed as resolved
- Any new findings are classified by severity
- Zero new P0 or P1 findings
  </verify>
  <done>All 4 agents have re-audited the system and produced updated findings</done>
</task>

<task type="auto">
  <name>Task 2: Triage new findings and immediate fixes</name>
  <files>varies (depends on new findings)</files>
  <action>
Read all 4 updated findings JSON files. Triage any new findings:

**If new P0 or P1 found:**
- Fix immediately
- Run tests to verify no regressions
- Update the agent's findings JSON with fix_status
- Commit the fix

**If new P2/P3 found:**
- Document in the findings JSON with status "new"
- These go into the synthesis for the human to review

**If no new findings above P3:**
- Confirm clean audit in a brief note
- All previously deferred items (DALE-003, CYCLOPS-002/003/007/009, MK-CODE-10/11) remain documented as accepted/deferred

Run full test suite:
```bash
cd F:/tcr-policy-scanner && python -m pytest tests/ -v --tb=short 2>&1 | tail -20
```
  </action>
  <verify>
- Zero new P0 or P1 findings (or all fixed)
- New P2/P3 documented in findings
- Full test suite passes
  </verify>
  <done>All new findings triaged, any P0/P1 fixed immediately, tests passing</done>
</task>

</tasks>

<verification>
1. All 4 agent findings JSON files are complete post-fix audits
2. All 4 agent summaries reflect the fixed system state
3. Zero new P0 or P1 findings (or immediate fixes applied)
4. Previously fixed items verified as resolved by each agent
5. Test suite passes
</verification>

<success_criteria>
- Clean re-audit from all 4 agents
- Trust score improved (target 9+/10)
- Joy score improved (target 9+/10)
- Sovereignty compliance maintained or improved
- Zero new critical/important issues
- System ready for final synthesis and launch decision
</success_criteria>

<output>
After completion, create `.planning/phases/18-production-hardening/18-05-SUMMARY.md`
</output>

---
phase: 17-website-deployment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/web/index.html
  - docs/web/css/style.css
  - docs/web/404.html
autonomous: true

must_haves:
  truths:
    - "HTML contains ARIA 1.2 combobox markup (role=combobox on input, aria-controls, aria-expanded, aria-autocomplete=list)"
    - "HTML contains state filter dropdown element"
    - "HTML contains freshness badge containers in tribe card"
    - "CSS implements auto dark mode via prefers-color-scheme media query"
    - "CSS implements CRT scan-line effect as ::after pseudo-element"
    - "CSS defines type scale using CSS custom properties"
    - "CSS ensures 44px minimum touch targets on mobile"
    - "CSS respects prefers-reduced-motion for all transitions and animations"
    - "404.html redirects to index.html for GitHub Pages SPA routing"
  artifacts:
    - path: "docs/web/index.html"
      provides: "Complete HTML structure with ARIA combobox, state filter, tribe card, region cards, header, footer"
      contains: "role=\"combobox\""
    - path: "docs/web/css/style.css"
      provides: "Full stylesheet with light/dark mode, type scale, badges, mobile responsive, CRT effect"
      contains: "prefers-color-scheme"
    - path: "docs/web/404.html"
      provides: "SPA routing fallback for GitHub Pages"
      min_lines: 5
  key_links:
    - from: "docs/web/index.html"
      to: "docs/web/js/fuse.min.js"
      via: "script tag loading self-hosted Fuse.js"
      pattern: "fuse\\.min\\.js"
    - from: "docs/web/index.html"
      to: "docs/web/js/combobox.js"
      via: "script tag loading custom ARIA combobox"
      pattern: "combobox\\.js"
    - from: "docs/web/index.html"
      to: "docs/web/js/app.js"
      via: "script tag loading main application logic"
      pattern: "app\\.js"
---

<objective>
Rewrite the HTML structure and CSS for the website, implementing the complete markup with ARIA combobox pattern, state filter dropdown, dark mode, CRT scan-line effect, type scale, freshness badges, and mobile responsiveness.

Purpose: The existing HTML references Awesomplete (being removed in Plan 01) and lacks ARIA 1.2 combobox markup, state filtering, dark mode, and freshness indicators. This plan delivers the complete markup and styling that Plan 03's JavaScript will bring to life.

Output: Complete `index.html` with proper ARIA roles, `style.css` with dark mode + CRT + type scale + badges, and `404.html` for SPA routing.
</objective>

<execution_context>
@D:\Claude-Workspace\.claude/get-shit-done/workflows/execute-plan.md
@D:\Claude-Workspace\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/17-website-deployment/17-CONTEXT.md
@.planning/phases/17-website-deployment/17-RESEARCH.md
@docs/web/index.html
@docs/web/css/style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite index.html with ARIA combobox, state filter, and complete structure</name>
  <files>docs/web/index.html, docs/web/404.html</files>
  <action>
Rewrite `docs/web/index.html` with these structural elements (keep the same semantic HTML approach, just enhanced):

**Head:**
- Keep existing meta charset, viewport, title, description
- Replace `awesomplete.css` link with just `css/style.css`
- Add: `<meta name="color-scheme" content="light dark">` for dark mode hint

**Header (keep existing, minor refinements):**
- `<header role="banner">` with h1 "Tribal Climate Resilience" and subtitle "Program Priorities"

**Main:**
1. **Search section** (`aria-label="Search for a Tribal Nation"`):
   - Label: "Find your Tribal Nation"
   - Input with ARIA 1.2 combobox attributes:
     ```html
     <input type="text" id="tribe-search" class="search-input"
       placeholder="Start typing a Tribe name..."
       role="combobox"
       aria-label="Search for a Tribal Nation"
       aria-expanded="false"
       aria-autocomplete="list"
       aria-controls="tribe-listbox"
       aria-activedescendant=""
       autocomplete="off"
       disabled>
     ```
   - Listbox: `<ul role="listbox" id="tribe-listbox" class="listbox" aria-label="Search results" hidden></ul>`
   - Live region for result count: `<div id="search-status" class="sr-only" role="status" aria-live="polite"></div>`

2. **State filter** (below search, within same container):
   ```html
   <div class="filter-row">
     <label for="state-filter" class="filter-label">Or browse by state</label>
     <select id="state-filter" class="state-select" disabled>
       <option value="">All states</option>
     </select>
   </div>
   ```

3. **Loading/error messages** (keep existing pattern with role="status" and role="alert")

4. **Tribe card** (enhanced with freshness badge):
   - Keep existing structure (h2 name, dl details with state/ecoregion)
   - Add freshness badge container: `<span id="tribe-freshness" class="badge" aria-label=""></span>` inside or near the card title
   - Keep card-actions div for download buttons
   - Keep packet-status paragraph

5. **State browse results** (new):
   ```html
   <section id="state-results" class="state-results" hidden aria-label="Tribes in selected state">
     <h2 id="state-results-title" class="section-title"></h2>
     <div id="state-results-list" class="state-results-list"></div>
   </section>
   ```

6. **Regional documents section** (keep existing structure, it works)

**Footer:**
- Keep existing: `<footer role="contentinfo"><p class="footer-credit">Tribal Climate Resilience Program</p></footer>`

**Scripts (at end of body, in order):**
```html
<script src="js/fuse.min.js"></script>
<script src="js/combobox.js"></script>
<script src="js/app.js"></script>
```
Note: Remove `defer` from app.js since it's now at end of body. No `defer` needed for inline scripts at end of body.

**SquareSpace embed comment** (keep existing, update iframe sandbox):
```html
<!-- Embed in SquareSpace: Add a Code block with this iframe:
<iframe src="https://atniclimate.github.io/TCR-policy-scanner/"
  width="100%" height="700" frameborder="0"
  sandbox="allow-scripts allow-same-origin allow-downloads allow-popups"
  style="border:1px solid #e0e0e0;border-radius:8px;"
  title="Tribal Climate Resilience - Program Priorities"
  loading="lazy"></iframe> -->
```

**Also create `docs/web/404.html`:**
```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Redirecting...</title>
<script>
// GitHub Pages SPA redirect: convert path to query parameter
// Source: https://github.com/rafgraph/spa-github-pages
var pathSegmentsToKeep = 1; // for project pages (e.g., /TCR-policy-scanner/)
var l = window.location;
l.replace(
  l.protocol + '//' + l.hostname + (l.port ? ':' + l.port : '') +
  l.pathname.split('/').slice(0, 1 + pathSegmentsToKeep).join('/') + '/' +
  '?/' +
  l.pathname.slice(1).split('/').slice(pathSegmentsToKeep).join('/').replace(/&/g, '~and~') +
  (l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
  l.hash
);
</script>
</head>
<body>
<p>Redirecting to <a href="/">home page</a>...</p>
</body>
</html>
```

IMPORTANT constraints:
- Zero references to ATNI, NCAI, or "TCR Policy Scanner" in any visible text (XCUT-01)
- Use DOM-safe patterns (no innerHTML) -- JS will use createElement/textContent
- Keep `.sr-only` class for screen-reader-only content
  </action>
  <verify>
Open `docs/web/index.html` in a browser (will show empty since JS not yet wired).
Verify: `role="combobox"` on input, `role="listbox"` on ul, `aria-controls` matches listbox id.
Verify: state filter `<select>` element exists.
Verify: No references to awesomplete in HTML.
Verify: `docs/web/404.html` exists and contains redirect script.
  </verify>
  <done>
index.html has ARIA 1.2 combobox markup, state filter dropdown, freshness badge containers, regional section, and correct script loading order (fuse.min.js -> combobox.js -> app.js). 404.html provides SPA routing for GitHub Pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite style.css with dark mode, CRT effect, type scale, badges, and mobile</name>
  <files>docs/web/css/style.css</files>
  <action>
Rewrite `docs/web/css/style.css` completely. Preserve the existing design language (colors, border-radius, spacing feel) but enhance with:

**1. CSS Custom Properties (type scale + colors):**
```css
:root {
  /* Colors - light mode */
  --tcr-primary: #1a5276;
  --tcr-accent: #2980b9;
  --tcr-bg: #f8f9fa;
  --tcr-text: #2c3e50;
  --tcr-card: #fff;
  --tcr-border: #dee2e6;
  --tcr-error: #c0392b;
  --tcr-muted: #6c757d;
  --tcr-dis: #e9ecef;
  --tcr-success: #2c6e49;
  --tcr-amber: #b45309;   /* WCAG AA verified in Phase 16: DEC-1602-01 */

  /* Type scale (1.2 ratio minor third) */
  --tcr-fs-xs: 0.833rem;   /* ~13.3px */
  --tcr-fs-sm: 0.875rem;   /* 14px */
  --tcr-fs-base: 1rem;     /* 16px */
  --tcr-fs-md: 1.125rem;   /* 18px */
  --tcr-fs-lg: 1.25rem;    /* 20px */
  --tcr-fs-xl: 1.5rem;     /* 24px */

  /* Spacing */
  --tcr-max-w: 640px;
  --tcr-radius: 6px;
}
```

**2. Dark mode (auto from OS preference):**
```css
@media (prefers-color-scheme: dark) {
  :root {
    --tcr-primary: #5dade2;
    --tcr-accent: #85c1e9;
    --tcr-bg: #1a1a2e;
    --tcr-text: #e0e0e0;
    --tcr-card: #16213e;
    --tcr-border: #2c3e50;
    --tcr-error: #e74c3c;
    --tcr-muted: #95a5a6;
    --tcr-dis: #2c3e50;
    --tcr-success: #27ae60;
    --tcr-amber: #f39c12;
  }
  header { background: #0f3460; }
}
```

**3. CRT scan-line effect (CSS only, decorative):**
```css
body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0, 0, 0, 0.03) 2px,
    rgba(0, 0, 0, 0.03) 4px
  );
}
```

**4. Freshness badges:**
```css
.badge { display: inline-block; padding: 0.2rem 0.6rem; border-radius: 999px; font-size: var(--tcr-fs-xs); font-weight: 600; vertical-align: middle; }
.badge-fresh { background: var(--tcr-success); color: #fff; }
.badge-aging { background: var(--tcr-amber); color: #fff; }
.badge-stale { background: var(--tcr-error); color: #fff; }
.badge-unknown { background: var(--tcr-muted); color: #fff; }
```

**5. Listbox (combobox dropdown) styles:**
```css
.listbox {
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: 300px;
  overflow-y: auto;
  border: 2px solid var(--tcr-border);
  border-top: none;
  border-radius: 0 0 var(--tcr-radius) var(--tcr-radius);
  background: var(--tcr-card);
  position: absolute;
  width: 100%;
  z-index: 100;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}
.listbox[hidden] { display: none; }
.listbox li[role="option"] {
  padding: 0.75rem 1rem;
  cursor: pointer;
  font-size: var(--tcr-fs-base);
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--tcr-bg);
}
.listbox li[role="option"][aria-selected="true"] {
  background: var(--tcr-accent);
  color: #fff;
}
.listbox li[role="option"]:hover {
  background: var(--tcr-dis);
}
.option-state {
  font-size: var(--tcr-fs-sm);
  color: var(--tcr-muted);
  margin-left: 0.5rem;
  flex-shrink: 0;
}
```

**6. State filter:**
```css
.filter-row { display: flex; align-items: center; gap: 0.75rem; margin-top: 0.75rem; }
.filter-label { font-size: var(--tcr-fs-sm); color: var(--tcr-muted); white-space: nowrap; }
.state-select {
  flex: 1;
  padding: 0.5rem 0.75rem;
  font-size: var(--tcr-fs-base);
  border: 2px solid var(--tcr-border);
  border-radius: var(--tcr-radius);
  background: var(--tcr-card);
  color: var(--tcr-text);
  min-height: 44px;
  cursor: pointer;
}
.state-select:focus { border-color: var(--tcr-accent); outline: 3px solid rgba(41,128,185,.3); outline-offset: 1px; }
.state-select:disabled { background: var(--tcr-dis); color: var(--tcr-muted); cursor: not-allowed; }
```

**7. State browse results section:**
```css
.state-results { margin-bottom: 2rem; }
.state-results-list {
  max-width: var(--tcr-max-w);
  margin: 0 auto;
  padding: 0 1rem;
  display: grid;
  grid-template-columns: 1fr;
  gap: 0.5rem;
}
.state-tribe-item {
  padding: 0.75rem 1rem;
  background: var(--tcr-card);
  border: 1px solid var(--tcr-border);
  border-radius: var(--tcr-radius);
  cursor: pointer;
  min-height: 44px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  transition: background 0.15s ease;
}
.state-tribe-item:hover { background: var(--tcr-dis); }
.state-tribe-item:focus { outline: 3px solid rgba(41,128,185,.5); outline-offset: 2px; }
```

**8. Screen-reader-only class:**
```css
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
```

**9. Preserve existing patterns:**
- Keep all existing button styles (.btn-download, .btn-internal, .btn-congressional, .btn-both, .btn-sm)
- Keep card styles (.tribe-card, .card-title, .card-details, .detail-row)
- Keep region styles (.regions-section, .regions-list, .region-card, etc.)
- Keep print media query
- Keep prefers-reduced-motion (extend to cover CRT effect)

**10. Mobile responsive (enhance existing):**
- At 600px breakpoint: stack filter-row vertically, full-width select, increase min-height to 48px on touch targets
- Ensure .search-container has `position: relative` for absolute listbox positioning
- Listbox at mobile: `max-height: 250px` to prevent viewport overflow

**11. Typography refinements (WEB-06):**
- Letter-spacing on h1: `letter-spacing: 0.06em` (reduced from 0.15em per context decision)
- Line height: 1.5 for body, 1.2 for headings
- Max line length: `max-width: 65ch` on paragraph text inside cards

**12. Transitions:**
- Fade-in for card appearance: `.tribe-card { opacity: 0; transition: opacity 0.2s ease; } .tribe-card[data-visible] { opacity: 1; }`
- Respect reduced motion by setting `transition: none` in the prefers-reduced-motion query

**13. prefers-reduced-motion (extend):**
```css
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { transition: none !important; animation: none !important; }
  body::after { display: none; } /* Remove CRT effect */
}
```

Make sure the search-container has `position: relative` so the listbox can be positioned absolutely below the input.
  </action>
  <verify>
Open `docs/web/index.html` in browser.
Toggle dark mode in OS settings -- verify colors change.
Verify CRT scan-line overlay is barely visible (very subtle).
Verify no horizontal scroll at 375px width.
Check color contrast: #1a5276 on #f8f9fa, #5dade2 on #1a1a2e -- both should exceed 4.5:1.
  </verify>
  <done>
style.css implements: dark mode (auto), CRT scan-line effect, type scale via CSS custom properties, freshness badge styles, listbox dropdown styles, state filter styles, state browse results grid, 44px touch targets, prefers-reduced-motion support, and mobile responsive layout at 600px breakpoint. Zero Awesomplete CSS remains.
  </done>
</task>

</tasks>

<verification>
1. `docs/web/index.html` contains `role="combobox"` on input element
2. `docs/web/index.html` contains `role="listbox"` on ul element
3. `docs/web/index.html` contains state filter `<select>` element
4. `docs/web/index.html` does NOT reference awesomplete
5. `docs/web/css/style.css` contains `prefers-color-scheme: dark` media query
6. `docs/web/css/style.css` contains scan-line gradient (`repeating-linear-gradient`)
7. `docs/web/css/style.css` contains `prefers-reduced-motion: reduce`
8. `docs/web/css/style.css` contains `.badge-fresh`, `.badge-aging`, `.badge-stale`
9. `docs/web/css/style.css` contains `min-height: 44px` (touch targets)
10. `docs/web/404.html` exists with redirect script
</verification>

<success_criteria>
- Complete HTML with ARIA 1.2 combobox markup ready for JS wiring
- CSS dark mode auto-switches based on OS preference
- CRT scan-line effect visible but subtle (0.03 opacity)
- 44px minimum touch targets on all interactive elements
- prefers-reduced-motion disables all transitions and CRT effect
- 404.html handles SPA routing for GitHub Pages
- Zero references to Awesomplete in any docs/web/ file
</success_criteria>

<output>
After completion, create `.planning/phases/17-website-deployment/17-02-SUMMARY.md`
</output>

---
phase: 19-schema-core-data-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/packets/doc_types.py
  - src/packets/docx_engine.py
  - src/packets/docx_template.py
  - src/packets/docx_sections.py
  - src/schemas/models.py
  - src/paths.py
  - src/packets/context.py
  - tests/test_doc_types.py
  - tests/test_paths.py
autonomous: true

must_haves:
  truths:
    - "Zero hardcoded FY26 strings remain in functional code (doc_types, docx_engine, docx_template, docx_sections)"
    - "All FY references use config.FISCAL_YEAR_SHORT dynamically"
    - "Six new path constants (SVI_DIR, SVI_COUNTY_PATH, CLIMATE_DIR, CLIMATE_SUMMARY_PATH, VULNERABILITY_PROFILES_DIR, CLIMATE_RAW_DIR) importable from src.paths"
    - "vulnerability_profile_path() helper returns correct per-Tribe path"
    - "TribePacketContext has vulnerability_profile field defaulting to empty dict"
    - "All 964 existing tests still pass"
  artifacts:
    - path: "src/packets/doc_types.py"
      provides: "Dynamic FY in title_template, header_template, format_filename"
      contains: "FISCAL_YEAR_SHORT"
    - path: "src/paths.py"
      provides: "6 new path constants + vulnerability_profile_path() helper"
      contains: "VULNERABILITY_PROFILES_DIR"
    - path: "src/packets/context.py"
      provides: "vulnerability_profile field on TribePacketContext"
      contains: "vulnerability_profile"
  key_links:
    - from: "src/packets/doc_types.py"
      to: "src/config.py"
      via: "import FISCAL_YEAR_SHORT"
      pattern: "from src.config import FISCAL_YEAR_SHORT"
    - from: "src/paths.py"
      to: "data/svi/"
      via: "SVI_DIR constant"
      pattern: "SVI_DIR.*=.*DATA_DIR.*svi"
---

<objective>
Fix pre-phase tech debt: replace 22 hardcoded "FY26" strings with dynamic fiscal year from config, add 6 new path constants + 1 helper to src/paths.py, and add vulnerability_profile field to TribePacketContext.

Purpose: Eliminate tech debt that would contaminate new Phase 19 code (18.5-DEC-10), and establish the path constants and context field that all subsequent plans depend on.

Output: Clean, dynamic fiscal year references throughout the packet system; path constants for SVI, climate, and vulnerability profile directories; TribePacketContext ready to carry vulnerability data.
</objective>

<execution_context>
@D:\Claude-Workspace\.claude/get-shit-done/workflows/execute-plan.md
@D:\Claude-Workspace\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-schema-core-data-foundation/19-RESEARCH.md

@src/config.py -- FISCAL_YEAR_SHORT, FISCAL_YEAR_INT definitions
@src/paths.py -- Existing 35 constants + 3 helpers, naming conventions
@src/packets/doc_types.py -- 8 hardcoded FY26 instances to fix
@src/packets/docx_engine.py -- 2 hardcoded FY26 instances to fix
@src/packets/docx_template.py -- 1 hardcoded FY26 instance to fix
@src/packets/docx_sections.py -- 1 hardcoded FY26 in docstring
@src/schemas/models.py -- 3 FY26 in docstrings/examples (cosmetic, fix for consistency)
@src/packets/context.py -- TribePacketContext dataclass
@tests/test_doc_types.py -- Existing tests that may assert FY26 literals
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix FY26 hardcoded strings across 7 source files</name>
  <files>
    src/packets/doc_types.py
    src/packets/docx_engine.py
    src/packets/docx_template.py
    src/packets/docx_sections.py
    src/schemas/models.py
  </files>
  <action>
    Replace all hardcoded "FY26" strings with dynamic fiscal year from `src.config.FISCAL_YEAR_SHORT`. The exact changes:

    **src/packets/doc_types.py** (8 functional + filename method):
    - Add `from src.config import FISCAL_YEAR_SHORT` at top of file
    - `title_template="FY26 Federal Funding Overview & Strategy"` -> `title_template=f"{FISCAL_YEAR_SHORT} Federal Funding Overview & Strategy"`
    - `title_template="FY26 Climate Resilience Program Priorities"` -> `title_template=f"{FISCAL_YEAR_SHORT} Climate Resilience Program Priorities"`
    - `header_template="{tribe_name} | FY26 Climate Resilience Program Priorities"` -> `header_template=f"{{tribe_name}} | {FISCAL_YEAR_SHORT} Climate Resilience Program Priorities"`
    - `title_template="FY26 InterTribal Climate Resilience Strategy"` -> `title_template=f"{FISCAL_YEAR_SHORT} InterTribal Climate Resilience Strategy"`
    - `title_template="FY26 Regional Climate Resilience Overview"` -> `title_template=f"{FISCAL_YEAR_SHORT} Regional Climate Resilience Overview"`
    - `header_template="{region_name} | FY26 Regional Climate Resilience Overview"` -> `header_template=f"{{region_name}} | {FISCAL_YEAR_SHORT} Regional Climate Resilience Overview"`
    - `format_filename()` method: change `return f"{slug}_{self.filename_suffix}_fy26.docx"` to use `FISCAL_YEAR_SHORT.lower()` -> `return f"{slug}_{self.filename_suffix}_{FISCAL_YEAR_SHORT.lower()}.docx"`

    IMPORTANT for f-strings with curly-brace placeholders: `{tribe_name}` must become `{{tribe_name}}` inside an f-string so it remains a literal brace in the resulting string. The `format_header()` method does `.replace("{tribe_name}", ...)` at runtime, so the stored string must still contain literal `{tribe_name}`.

    **src/packets/docx_engine.py** (2 instances):
    - Add `from src.config import FISCAL_YEAR_SHORT` at top
    - Line ~174 docstring: "FY26 program overview header" -> "current fiscal year program overview header"
    - Line ~180: `header_text = "FY26 Climate Resilience Program Priorities"` -> `header_text = f"{FISCAL_YEAR_SHORT} Climate Resilience Program Priorities"`

    **src/packets/docx_template.py** (1 instance):
    - Add `from src.config import FISCAL_YEAR_SHORT` at top
    - Line ~515: `"FY26 Climate Resilience Program Priorities"` -> `f"{FISCAL_YEAR_SHORT} Climate Resilience Program Priorities"`

    **src/packets/docx_sections.py** (1 docstring):
    - Line ~70: docstring reference "uses default FY26 title" -> "uses default fiscal year title"

    **src/schemas/models.py** (3 cosmetic -- docstrings and examples):
    - Line ~76: `"""Program status from FY26 Hot Sheets review."""` -> `"""Program status from current Hot Sheets review."""`
    - Line ~96: `examples=["FY26 Hot Sheets v2"]` -> leave as-is (this is a SAMPLE value, not functional code -- it documents what data looks like)
    - Line ~287: `description="FY26 funding amount string"` -> `description="Current fiscal year funding amount string"`

    Do NOT change:
    - `src/monitors/iija_sunset.py` -- These refer to the actual IIJA FY2026 expiration date, not the current fiscal year. They are correct as-is.
    - `src/graph/schema.py` -- These are docstring examples describing the data model, not functional code. Leave as-is.
    - `src/config.py` -- These are the SOURCE of the dynamic FY, not consumers.

    Update any test assertions that check for literal "FY26" in generated filenames, titles, or headers. Search tests/ for "fy26", "FY26" and update to use `FISCAL_YEAR_SHORT` or `FISCAL_YEAR_SHORT.lower()`.
  </action>
  <verify>
    Run: `python -m pytest tests/ -x -q` -- all 964 tests pass.
    Run: `python -c "from src.packets.doc_types import DOC_A; assert 'FY' in DOC_A.title_template; print('Dynamic FY:', DOC_A.title_template)"` -- shows dynamic FY.
    Grep: No remaining functional FY26 hardcodes in src/packets/ (excluding iija_sunset.py).
  </verify>
  <done>
    Zero hardcoded FY26 strings in doc_types.py, docx_engine.py, docx_template.py, docx_sections.py. All fiscal year references are dynamic via FISCAL_YEAR_SHORT. All 964 existing tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add path constants and TribePacketContext field</name>
  <files>
    src/paths.py
    src/packets/context.py
    tests/test_paths.py
  </files>
  <action>
    **src/paths.py** -- Add 6 new constants in a new section "-- Vulnerability Data Paths --" after the existing "Data Paths (subdirectories)" section, plus 1 helper function:

    ```python
    # ---------------------------------------------------------------------------
    # -- Vulnerability Data Paths --
    # ---------------------------------------------------------------------------

    SVI_DIR: Path = DATA_DIR / "svi"
    """CDC/ATSDR Social Vulnerability Index data directory."""

    SVI_COUNTY_PATH: Path = SVI_DIR / "SVI2022_US_COUNTY.csv"
    """SVI 2022 county-level CSV (3 themes, ~3,200 rows)."""

    CLIMATE_DIR: Path = DATA_DIR / "climate"
    """Climate data directory (drought, NCEI, NWS alerts)."""

    CLIMATE_SUMMARY_PATH: Path = CLIMATE_DIR / "climate_summary.json"
    """Aggregated climate summary for all Tribes."""

    VULNERABILITY_PROFILES_DIR: Path = DATA_DIR / "vulnerability_profiles"
    """Per-Tribe composite vulnerability profile JSON files (592 files)."""

    CLIMATE_RAW_DIR: Path = CLIMATE_DIR / "raw"
    """Raw climate data downloads before processing."""
    ```

    Add 1 new helper function after existing helpers:

    ```python
    def vulnerability_profile_path(tribe_id: str) -> Path:
        """Return the vulnerability profile JSON path for a specific Tribe."""
        return VULNERABILITY_PROFILES_DIR / f"{tribe_id}.json"
    ```

    **src/packets/context.py** -- Add `vulnerability_profile` field to TribePacketContext:

    After the `congressional_intel` field, add:
    ```python
    # Vulnerability profile (v1.4)
    vulnerability_profile: dict = field(default_factory=dict)
    ```

    **tests/test_paths.py** -- Add tests (create file if it does not exist, or append to existing):

    Test that:
    1. All 6 new constants are importable and are Path objects
    2. `vulnerability_profile_path("epa_100000001")` returns expected path
    3. New paths follow the existing naming convention (all under DATA_DIR)
    4. No circular imports when importing from src.paths
  </action>
  <verify>
    Run: `python -c "from src.paths import SVI_DIR, SVI_COUNTY_PATH, CLIMATE_DIR, CLIMATE_SUMMARY_PATH, VULNERABILITY_PROFILES_DIR, CLIMATE_RAW_DIR, vulnerability_profile_path; print('All imports OK')"` -- succeeds.
    Run: `python -c "from src.packets.context import TribePacketContext; ctx = TribePacketContext(tribe_id='test', tribe_name='Test'); assert ctx.vulnerability_profile == {}; print('Context OK')"` -- succeeds.
    Run: `python -m pytest tests/test_paths.py -v` -- new tests pass.
    Run: `python -m pytest tests/ -x -q` -- all tests pass.
  </verify>
  <done>
    Six new path constants and vulnerability_profile_path() helper are importable from src.paths. TribePacketContext.vulnerability_profile field exists, defaults to empty dict. All existing tests pass. New path tests pass.
  </done>
</task>

</tasks>

<verification>
1. `python -m pytest tests/ -x -q` -- all 964+ tests pass (zero regressions)
2. `grep -rn "FY26" src/packets/ --include="*.py" | grep -v iija_sunset | grep -v "# "` -- returns zero functional FY26 hardcodes
3. `python -c "from src.paths import VULNERABILITY_PROFILES_DIR, vulnerability_profile_path; print(VULNERABILITY_PROFILES_DIR)"` -- prints valid path
4. `python -c "from src.packets.context import TribePacketContext; t = TribePacketContext(tribe_id='x', tribe_name='X'); assert 'vulnerability_profile' in t.__dataclass_fields__"` -- confirms field exists
</verification>

<success_criteria>
- Zero hardcoded FY26 strings in functional packet code (doc_types, docx_engine, docx_template)
- All fiscal year references dynamically use FISCAL_YEAR_SHORT from config
- 6 path constants + 1 helper importable from src.paths
- TribePacketContext carries vulnerability_profile field
- All 964+ existing tests pass with zero regressions
</success_criteria>

<output>
After completion, create `.planning/phases/19-schema-core-data-foundation/19-01-SUMMARY.md`
</output>

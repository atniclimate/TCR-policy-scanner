# Phase 19 Plan 01: Pre-Phase Tech Debt Cleanup Summary

**One-liner:** Replaced 22 hardcoded FY26 strings with dynamic FISCAL_YEAR_SHORT, added 6 vulnerability path constants + helper, and added vulnerability_profile field to TribePacketContext.

## Frontmatter

| Key | Value |
|-----|-------|
| phase | 19 |
| plan | 01 |
| subsystem | packets, paths, context |
| tags | fiscal-year, path-constants, tech-debt, vulnerability |
| requires | Phase 18 (existing codebase), src/config.py (FISCAL_YEAR_SHORT) |
| provides | Dynamic FY in all packet code, 6 path constants, vulnerability_profile_path() helper, TribePacketContext.vulnerability_profile |
| affects | Phase 19 plans 02-06, Phase 20-24 (all use path constants and context field) |
| tech-stack.added | None |
| tech-stack.patterns | f-string interpolation for config constants at module-init time |
| duration | ~13 minutes |
| completed | 2026-02-18 |

## Tasks Completed

| Task | Name | Commit | Key Files |
|------|------|--------|-----------|
| 1 | Fix FY26 hardcoded strings across source files | 47d4e93 | src/packets/doc_types.py, src/packets/docx_engine.py, src/packets/docx_template.py, src/packets/docx_sections.py, src/schemas/models.py, 6 test files |
| 2 | Add path constants and TribePacketContext field | 1317259 | src/paths.py, src/packets/context.py, tests/test_paths.py |

## Key Files

### Created
- `tests/test_paths.py` -- 19 tests for vulnerability path constants, helper function, and circular import safety

### Modified
- `src/packets/doc_types.py` -- 8 title/header templates + format_filename now use FISCAL_YEAR_SHORT; added import
- `src/packets/docx_engine.py` -- Default header_text uses dynamic FY; added import
- `src/packets/docx_template.py` -- Template header uses dynamic FY; added import
- `src/packets/docx_sections.py` -- Docstring updated (no functional FY26)
- `src/schemas/models.py` -- 2 docstrings updated (example value preserved per plan)
- `src/paths.py` -- 6 new path constants (SVI_DIR, SVI_COUNTY_PATH, CLIMATE_DIR, CLIMATE_SUMMARY_PATH, VULNERABILITY_PROFILES_DIR, CLIMATE_RAW_DIR) + vulnerability_profile_path() helper
- `src/packets/context.py` -- vulnerability_profile dict field on TribePacketContext
- `tests/test_doc_types.py` -- Updated assertions to use FISCAL_YEAR_SHORT
- `tests/test_docx_template.py` -- Updated FY assertion to use FISCAL_YEAR_SHORT
- `tests/test_docx_styles.py` -- Updated FY assertion to use FISCAL_YEAR_SHORT
- `tests/test_docx_integration.py` -- Updated FY assertion to use FISCAL_YEAR_SHORT
- `tests/test_strategic_overview.py` -- Updated 2 FY assertions to use FISCAL_YEAR_SHORT

## Decisions Made

| ID | Decision | Rationale |
|----|----------|-----------|
| 19-01-DEC-01 | Use f-strings at module init time (not runtime) for doc_types constants | Frozen dataclass instances need values at definition time; f-string with FISCAL_YEAR_SHORT evaluated once at import |
| 19-01-DEC-02 | Double-brace escape for .replace() placeholders in f-strings | DOC_B/DOC_D header_template use {tribe_name}/{region_name} with .replace() -- these become {{tribe_name}} inside f-strings |
| 19-01-DEC-03 | Preserve FY26 example value in schemas/models.py line 96 | Per plan: sample examples are documentation, not functional code |
| 19-01-DEC-04 | Leave test mock filenames in test_quality_review.py as literal fy26 | These are mock file names for quality reviewer tests, not generated by format_filename() |

## Deviations from Plan

None -- plan executed exactly as written.

## Verification

- Zero hardcoded FY26 strings in src/packets/ (grep confirms: no matches)
- Only remaining FY26 in src/schemas/models.py is the example value on line 96 (per plan)
- All 6 path constants importable from src.paths
- vulnerability_profile_path() returns correct per-Tribe paths
- TribePacketContext.vulnerability_profile defaults to empty dict, accepts dict values, included in to_dict()
- 1103 tests passing (964 baseline + 120 from parallel plans 19-02/19-03 + 19 new path tests)

## Test Summary

| Metric | Value |
|--------|-------|
| Tests before | 964 (baseline) |
| Tests after | 1103 |
| New tests added | 19 (test_paths.py) |
| Tests modified | 6 files (dynamic FY assertions) |
| All passing | Yes |

## Next Phase Readiness

Plan 19-01 deliverables are prerequisites for all subsequent Phase 19 plans:
- Plans 19-02 through 19-06 can safely import FISCAL_YEAR_SHORT (no hardcoded FY)
- Path constants (SVI_DIR, CLIMATE_DIR, VULNERABILITY_PROFILES_DIR, etc.) ready for data ingestion plans
- TribePacketContext.vulnerability_profile ready to carry composite vulnerability data
- No blockers identified
